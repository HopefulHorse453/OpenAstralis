package cc.astralis.module.impl.exploit.disablers;

import cc.astralis.event.EventTarget;
import cc.astralis.event.events.impl.network.PacketEvent;
import cc.astralis.module.Module;
import cc.astralis.module.SubModule;
import cc.astralis.util.network.PacketUtil;
import java.util.ArrayList;
import net.minecraft.network.protocol.Packet;
import net.minecraft.network.protocol.common.ServerboundPongPacket;

public class VerusFlyCheck2Disabler extends SubModule {
    private final ArrayList<Packet<?>> packetList = new ArrayList<>();
    private int packetSum;

    public VerusFlyCheck2Disabler(Module module) {
        super(module,"Verus Fly 2");
    }

    @Override
    public void onEnable() {
        packetList.clear();
        packetSum = 0;
        super.onEnable();
    }

    @EventTarget
    public void onPacket(PacketEvent event) {
        if (event.getPacket() instanceof ServerboundPongPacket) {
            packetList.add(event.getPacket());
            event.setCancelled(true);
        }

        packetSum++;

        if (packetSum > 100) {
            for (Packet<?> packet : packetList) {
                PacketUtil.send(packet);
            }
            packetSum = 0;
            packetList.clear();
        }
    }
}
