package cc.astralis.module.impl.exploit.disablers;
import cc.astralis.event.EventTarget;
import cc.astralis.event.events.impl.network.PacketEvent;
import cc.astralis.module.Module;
import cc.astralis.module.SubModule;
import cc.astralis.util.network.PacketUtil;
import net.minecraft.network.protocol.game.ServerboundMovePlayerPacket;
import net.minecraft.network.protocol.game.ServerboundUseItemPacket;
import net.minecraft.tags.ItemTags;
import net.minecraft.world.InteractionHand;
import net.minecraft.world.phys.Vec3;

public class VerusTimerDisabler extends SubModule {
    private int tick;

    public VerusTimerDisabler(Module module) {
        super(module,"Verus Timer");
    }

    @Override
    public void onEnable() {
        this.tick = 0;
        super.onEnable();
    }

    @EventTarget
    public void onPacket(PacketEvent event) {
        if (event.getPacket() instanceof ServerboundMovePlayerPacket packet) {
            event.setCancelled(true);
            PacketUtil.sendNoEvent(new ServerboundMovePlayerPacket.PosRot(new Vec3(packet.getX(mc.player.getX()), packet.getY(mc.player.getY()), packet.getZ(mc.player.getZ())), packet.getYRot(mc.player.getYRot()), packet.getXRot(mc.player.getXRot()), packet.isOnGround(), mc.player.horizontalCollision));
            if (tick % 3 == 0)
                PacketUtil.send(new ServerboundUseItemPacket(mc.player.getInventory().getSelectedItem().is(ItemTags.SWORDS) ? InteractionHand.OFF_HAND : InteractionHand.MAIN_HAND, 0, 0, 0));
            tick++;
        }
    }
}
